---
date: '2010-04-22T09:07:00+00:00'
title: Pretty options for Django's auth.User
draft: false
tags:
- Python
- django
- web
slug: pretty-options-for-djangos-authuser
description: Several of my Django...
markup: html
url: /blog/pretty-options-for-djangos-authuser/
aliases:
- /blog/2010/04/22/pretty-options-for-djangos-authuser/

---

Several of my Django Apps have Foreign Key relationships to django.contrib.auth.model.User.  In Django's admin app, these show up a select elements displaying the username attribute.  For some people, that may be OK, but for most of the people with which I work, it's not.  We want to see <em>prettier</em> options, i.e. each User's full name as the options in that select element.<br /><br />So, here's how it works. We override the ModelChoiceField (for ForeignKeys) and the ModelMultipleChoiceField (for ManyToMany Fields):<br /><div class="highlight" ><pre><span style="color: #007020; font-weight: bold">from</span> <span style="color: #0e84b5; font-weight: bold">django.forms</span> <span style="color: #007020; font-weight: bold">import</span> ModelChoiceField, ModelMultipleChoiceField<br /><br /><span style="color: #007020; font-weight: bold">class</span> <span style="color: #0e84b5; font-weight: bold">UserModelChoiceField</span>(ModelChoiceField):<br />    <span style="color: #4070a0; font-style: italic">&#39;&#39;&#39; </span><br /><span style="color: #4070a0; font-style: italic">    A ModelChoiceField to represent User </span><br /><span style="color: #4070a0; font-style: italic">    select boxes in the Auto Admin </span><br /><span style="color: #4070a0; font-style: italic">    &#39;&#39;&#39;</span><br />    <span style="color: #007020; font-weight: bold">def</span> <span style="color: #06287e">label_from_instance</span>(<span style="color: #007020">self</span>, obj):<br />        <span style="color: #007020; font-weight: bold">return</span> <span style="color: #4070a0">&quot;</span><span style="color: #70a0d0; font-style: italic">%s</span><span style="color: #4070a0"> (</span><span style="color: #70a0d0; font-style: italic">%s</span><span style="color: #4070a0">)&quot;</span><span style="color: #666666">%</span>(obj<span style="color: #666666">.</span>get_full_name(), obj<span style="color: #666666">.</span>username)<br /><br /><span style="color: #007020; font-weight: bold">class</span> <span style="color: #0e84b5; font-weight: bold">UserModelMultipleChoiceField</span>(ModelMultipleChoiceField):<br />    <span style="color: #4070a0; font-style: italic">&#39;&#39;&#39; </span><br /><span style="color: #4070a0; font-style: italic">    Similar to UserModelChoiceField, provide a nicer-looking </span><br /><span style="color: #4070a0; font-style: italic">    list of user names for ManyToMany Relations...</span><br /><span style="color: #4070a0; font-style: italic">    &#39;&#39;&#39;</span><br />    <span style="color: #007020; font-weight: bold">def</span> <span style="color: #06287e">label_from_instance</span>(<span style="color: #007020">self</span>, obj):<br />        <span style="color: #007020; font-weight: bold">return</span> <span style="color: #4070a0">&quot;</span><span style="color: #70a0d0; font-style: italic">%s</span><span style="color: #4070a0"> (</span><span style="color: #70a0d0; font-style: italic">%s</span><span style="color: #4070a0">)&quot;</span><span style="color: #666666">%</span>(obj<span style="color: #666666">.</span>get_full_name(), obj<span style="color: #666666">.</span>username)<br /></pre></div><br /><br />Then, to customize the admin, you need to create a custome ModelForm for your Model. So, if I had a Model that looked like this: <br /><div class="highlight" ><pre><span style="color: #007020; font-weight: bold">class</span> <span style="color: #0e84b5; font-weight: bold">MyModel</span>(models<span style="color: #666666">.</span>Model):<br />    user <span style="color: #666666">=</span> models<span style="color: #666666">.</span><span style="color: #007020">ForeignKey</span>(User)<br /></pre></div><br /><br />You'd need to create the following ModelForm:<br /><div class="highlight" ><pre><span style="color: #007020; font-weight: bold">class</span> <span style="color: #0e84b5; font-weight: bold">MyModelAdminForm</span>(forms<span style="color: #666666">.</span>ModelForm):<br />    user <span style="color: #666666">=</span> UserModelChoiceField(User<span style="color: #666666">.</span>objects<span style="color: #666666">.</span>all()<span style="color: #666666">.</span>order_by(<span style="color: #4070a0">&#39;first_name&#39;</span>, <span style="color: #4070a0">&#39;last_name&#39;</span>, <span style="color: #4070a0">&#39;username&#39;</span>))<br /><br />    <span style="color: #007020; font-weight: bold">class</span> <span style="color: #0e84b5; font-weight: bold">Meta</span>:<br />        model <span style="color: #666666">=</span> MyModel<br /></pre></div><br /><br /><br />Now, when you create a ModelAdmin class for the MyModel, you specify the above form:<br /><div class="highlight" ><pre><span style="color: #007020; font-weight: bold">from</span> <span style="color: #0e84b5; font-weight: bold">models</span> <span style="color: #007020; font-weight: bold">import</span> MyModel<br /><span style="color: #007020; font-weight: bold">from</span> <span style="color: #0e84b5; font-weight: bold">forms</span> <span style="color: #007020; font-weight: bold">import</span> MyModelAdminForm<br /><br /><span style="color: #007020; font-weight: bold">class</span> <span style="color: #0e84b5; font-weight: bold">MyModelAdmin</span>(admin<span style="color: #666666">.</span>ModelAdmin):<br />    form <span style="color: #666666">=</span> MyModelAdminForm<br />admin<span style="color: #666666">.</span>site<span style="color: #666666">.</span>register(MyModel, MyModelAdmin)<br /></pre></div><br /><br />At this point, the choices for User objects in the admin should contain the user's full name and their username in parenthesis.<div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/4123748873183487963-2524432454961244471?l=bradmontgomery.blogspot.com' alt='' /></div>