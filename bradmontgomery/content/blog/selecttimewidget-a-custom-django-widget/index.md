---
date: '2008-11-18T19:40:00+00:00'
title: 'SelectTimeWidget: A custom Django Widget'
draft: false
tags:
- Python
- django
slug: selecttimewidget-a-custom-django-widget
description: <p>I've been meaning...
markup: html
url: /blog/selecttimewidget-a-custom-django-widget/
aliases:
- /blog/2008/11/18/selecttimewidget-a-custom-django-widget/

---

<p>I've been meaning to write this blog post for quite some time...<br><br>Django Models provide a way to create a definitive source of data for web applications.  Written as a python class, a Django Model consists of Fields that (among other things) define a <em>type</em> for your data.  <br><br>Django's Forms provide a mechanism for generating HTML form elements and validating user input.  A sublcass of Django's Form class is the ModelForm which essentially creates a Form based on the Fields in a Model.  Form Fields and Model Fields are not the same--though there is a <a href="http://docs.djangoproject.com/en/dev/topics/forms/modelforms/#field-types" _mce_href="http://docs.djangoproject.com/en/dev/topics/forms/modelforms/#field-types">mapping from Model fields to Form fields</a>, however.  The Fields in a Form define the validation logic for the data entered into the html form elements generated by the Field.<br><br>When Django renders a Form, it chooses an appropriate html form element (such as input, textarea, or select elements) based on the type of Fields in the Form.  For example a form to save a URL with an associated title might look something like the following:</p><div class="highlight"><pre><span style="color: #007020; font-weight: bold" _mce_style="color: #007020; font-weight: bold;">from</span> <span style="color: #0e84b5; font-weight: bold" _mce_style="color: #0e84b5; font-weight: bold;">django</span> <span style="color: #007020; font-weight: bold" _mce_style="color: #007020; font-weight: bold;">import</span> forms<br><br><span style="color: #007020; font-weight: bold" _mce_style="color: #007020; font-weight: bold;">class</span> <span style="color: #0e84b5; font-weight: bold" _mce_style="color: #0e84b5; font-weight: bold;">LinkForm</span>(forms<span style="color: #666666" _mce_style="color: #666666;">.</span>Form):<br>    title <span style="color: #666666" _mce_style="color: #666666;">=</span> forms<span style="color: #666666" _mce_style="color: #666666;">.</span><span style="color: #007020" _mce_style="color: #007020;">CharField</span>() <br>    url <span style="color: #666666" _mce_style="color: #666666;">=</span> forms<span style="color: #666666" _mce_style="color: #666666;">.</span><span style="color: #007020" _mce_style="color: #007020;">URLField</span>()<br></pre></div><p><br>The HTML generated by calling this forms <em>as_table()</em> method might look something like this:</p><div class="highlight"><pre><span style="color: #c65d09; font-weight: bold" _mce_style="color: #c65d09; font-weight: bold;">&gt;&gt;&gt; </span>f <span style="color: #666666" _mce_style="color: #666666;">=</span> LinkForm()<br><span style="color: #c65d09; font-weight: bold" _mce_style="color: #c65d09; font-weight: bold;">&gt;&gt;&gt; </span>f<span style="color: #666666" _mce_style="color: #666666;">.</span>as_table()<br><span style="color: #808080" _mce_style="color: #808080;">&lt;tr&gt;&lt;th&gt;Title:&lt;/th&gt;&lt;td&gt;&lt;input type="text" name="title" /&gt;&lt;/td&gt;&lt;/tr&gt;</span><br><span style="color: #808080" _mce_style="color: #808080;">&lt;tr&gt;&lt;th&gt;Url:&lt;/th&gt;&lt;td&gt;&lt;input type="text" name="url"/&gt;&lt;/td&gt;&lt;/tr&gt;</span><br><span style="color: #808080" _mce_style="color: #808080;"></span></pre></div><p><br>We can change the behaviour of this output HTML by specifying a specific widget for the Form.  If for some <em>strange</em> reason we wanted the Title to render in a textarea, we would do the following:<br></p><div class="highlight"><pre>title <span style="color: #666666" _mce_style="color: #666666;">=</span> forms<span style="color: #666666" _mce_style="color: #666666;">.</span><span style="color: #007020" _mce_style="color: #007020;">CharField</span>(widget<span style="color: #666666" _mce_style="color: #666666;">=</span>forms<span style="color: #666666" _mce_style="color: #666666;">.</span>Textarea)<br></pre></div><p><br>All of this is well-documented in Django's <a href="http://docs.djangoproject.com/en/dev/ref/forms/widgets/" _mce_href="http://docs.djangoproject.com/en/dev/ref/forms/widgets/">Widget documentation</a>, which has been working well for me 80% of the time.<br><br>My big complaint here is that Date and Time information defaults to text input elements.  In the past, I've always liked to use select elements for situations when users would need to enter things like dates (perhaps a different select element for Months, Days, and Years) and time (different select elements for Hours, Minutes...<br><br>Luckily, (as of version 1.0, I think), Django offers a <b>SelectDateWidget</b> (located in <code>django.forms.extras.widgets</code>) which accomplishes this very thing.  It produces three select elements, and it can be attached to a Form's DateField.  This is accomplished like so:<br></p><div class="highlight"><pre>some_date <span style="color: #666666" _mce_style="color: #666666;">=</span> forms<span style="color: #666666" _mce_style="color: #666666;">.</span><span style="color: #007020" _mce_style="color: #007020;">DateField</span>(widget<span style="color: #666666" _mce_style="color: #666666;">=</span>SelectDateWidget, initial<span style="color: #666666" _mce_style="color: #666666;">=</span>datetime<span style="color: #666666" _mce_style="color: #666666;">.</span>date<span style="color: #666666" _mce_style="color: #666666;">.</span>today())<br></pre></div><p><br>That's Awesome!  I can even tell the widget to default to "today's" date by passing it an <em>initial</em> parameter containing the value generated by <em>datetime.date.today()</em>. Ok... what about times?  Would we ever want to enter Time information as three separate select elements.  I do, so I basically altered the <b>SelectDateWidget</b>, creating a <a href="http://www.djangosnippets.org/snippets/1202/" _mce_href="http://www.djangosnippets.org/snippets/1202/"><b>SelectTimeWidget</b></a>, which is available on <a href="http://www.djangosnippets.org/snippets/1202/" _mce_href="http://www.djangosnippets.org/snippets/1202/">django snippets</a>. It isn't perfect, but for now, it has accomplished what I've wanted... and its fairly flexible.<br></p><div class="highlight"><pre><span style="color: #60a0b0; font-style: italic" _mce_style="color: #60a0b0; font-style: italic;"># Specify a basic 24-hr time Widget (the default)</span><br>t <span style="color: #666666" _mce_style="color: #666666;">=</span> forms<span style="color: #666666" _mce_style="color: #666666;">.</span><span style="color: #007020" _mce_style="color: #007020;">TimeField</span>(widget<span style="color: #666666" _mce_style="color: #666666;">=</span>SelectTimeWidget())<br><br><span style="color: #60a0b0; font-style: italic" _mce_style="color: #60a0b0; font-style: italic;"># Force minutes and seconds to be displayed in increments of 10</span><br>t <span style="color: #666666" _mce_style="color: #666666;">=</span> forms<span style="color: #666666" _mce_style="color: #666666;">.</span><span style="color: #007020" _mce_style="color: #007020;">TimeField</span>(widget<span style="color: #666666" _mce_style="color: #666666;">=</span>SelectTimeWidget(minute_step<span style="color: #666666" _mce_style="color: #666666;">=</span><span style="color: #40a070" _mce_style="color: #40a070;">10</span>, second_step<span style="color: #666666" _mce_style="color: #666666;">=</span><span style="color: #40a070" _mce_style="color: #40a070;">10</span>))<br><br><span style="color: #60a0b0; font-style: italic" _mce_style="color: #60a0b0; font-style: italic;"># Use a 12-hr time format, which will display a 4th select </span><br><span style="color: #60a0b0; font-style: italic" _mce_style="color: #60a0b0; font-style: italic;"># element containing a.m. and p.m. options)</span><br>t <span style="color: #666666" _mce_style="color: #666666;">=</span> forms<span style="color: #666666" _mce_style="color: #666666;">.</span><span style="color: #007020" _mce_style="color: #007020;">TimeField</span>(widget<span style="color: #666666" _mce_style="color: #666666;">=</span>SelectTimeWidget(twelve_hr<span style="color: #666666" _mce_style="color: #666666;">=</span><span style="color: #007020" _mce_style="color: #007020;">True</span>))<br></pre></div><p><br>However, I often use DateTimeFields in both Models and Forms (which consists of date and time info).  All the code I need to represent select elements for such a field exists in both <b>SelectDateWidget</b> and <b>SelectTimeWidget</b>s.  The problem?  I just have figured out a <em>good</em> (read: proper) way to combine these two Widget classes.<br><br>Do I use multiple inheritance here... mixins... ?  My experience doing this in python is a bit rusty... (erm, non-existent!)  Hopefully the helpful <a href="http://groups.google.com/group/django-users/" _mce_href="http://groups.google.com/group/django-users/">django community</a> will help me out.  :)<br></p><hr><p><br>UPDATE: This discussion is continued in <a href="/blog/extending-djangos-multiwidget-splitselectdatetimewidget/" _mce_href="/blog/extending-djangos-multiwidget-splitselectdatetimewidget/" style="">Extending Django's MultiWidget: SplitSelectDateTimeWidget</a>.  I found a solution to this problem simply  by digging through Django's source code. Huzzah for Open Source!<br></p><hr><p><br><br>So if you had a project called <em>mysite</em> and an app called <em>myapp</em>, putting it all together would look something like this:<br><br></p><div class="highlight"><pre><span style="color: #60a0b0; font-style: italic" _mce_style="color: #60a0b0; font-style: italic;"># in urls.py</span><br>urlpatterns <span style="color: #666666" _mce_style="color: #666666;">+=</span> patterns(<span style="color: #4070a0" _mce_style="color: #4070a0;">''</span>,<br>    (<span style="color: #4070a0" _mce_style="color: #4070a0;">r'^test/$'</span>, <span style="color: #4070a0" _mce_style="color: #4070a0;">'mysite.myapp.views.test'</span>),<br>)<br><br><span style="color: #60a0b0; font-style: italic" _mce_style="color: #60a0b0; font-style: italic;"># in forms.py</span><br><span style="color: #007020; font-weight: bold" _mce_style="color: #007020; font-weight: bold;">class</span> <span style="color: #0e84b5; font-weight: bold" _mce_style="color: #0e84b5; font-weight: bold;">TestForm</span>(forms<span style="color: #666666" _mce_style="color: #666666;">.</span>Form):<br>    t <span style="color: #666666" _mce_style="color: #666666;">=</span> forms<span style="color: #666666" _mce_style="color: #666666;">.</span><span style="color: #007020" _mce_style="color: #007020;">TimeField</span>(widget<span style="color: #666666" _mce_style="color: #666666;">=</span>SelectTimeWidget(minute_step<span style="color: #666666" _mce_style="color: #666666;">=</span><span style="color: #40a070" _mce_style="color: #40a070;">15</span>, second_step<span style="color: #666666" _mce_style="color: #666666;">=</span><span style="color: #40a070" _mce_style="color: #40a070;">30</span>, twelve_hr<span style="color: #666666" _mce_style="color: #666666;">=</span><span style="color: #007020" _mce_style="color: #007020;">True</span>))<br><br><br><span style="color: #60a0b0; font-style: italic" _mce_style="color: #60a0b0; font-style: italic;"># in views.py</span><br><span style="color: #007020; font-weight: bold" _mce_style="color: #007020; font-weight: bold;">def</span> <span style="color: #06287e" _mce_style="color: #06287e;">test</span>(request):<br>    <span style="color: #007020; font-weight: bold" _mce_style="color: #007020; font-weight: bold;">from</span> <span style="color: #0e84b5; font-weight: bold" _mce_style="color: #0e84b5; font-weight: bold;">forms</span> <span style="color: #007020; font-weight: bold" _mce_style="color: #007020; font-weight: bold;">import</span> TestForm<br>    <br>    <span style="color: #007020; font-weight: bold" _mce_style="color: #007020; font-weight: bold;">if</span> request<span style="color: #666666" _mce_style="color: #666666;">.</span>method <span style="color: #666666" _mce_style="color: #666666;">==</span> <span style="color: #4070a0" _mce_style="color: #4070a0;">'POST'</span>:<br>        form <span style="color: #666666" _mce_style="color: #666666;">=</span> TestForm(request<span style="color: #666666" _mce_style="color: #666666;">.</span>POST)<br>        <span style="color: #007020; font-weight: bold" _mce_style="color: #007020; font-weight: bold;">if</span> form<span style="color: #666666" _mce_style="color: #666666;">.</span>is_valid():<br>            info <span style="color: #666666" _mce_style="color: #666666;">=</span> form<span style="color: #666666" _mce_style="color: #666666;">.</span>cleaned_data<br>    <span style="color: #007020; font-weight: bold" _mce_style="color: #007020; font-weight: bold;">else</span>:<br>        form <span style="color: #666666" _mce_style="color: #666666;">=</span> TestForm()<br>        <br>    <span style="color: #007020; font-weight: bold" _mce_style="color: #007020; font-weight: bold;">return</span> render_to_response(<span style="color: #4070a0" _mce_style="color: #4070a0;">'myapp/test.html'</span>,<br>                               <span style="color: #007020" _mce_style="color: #007020;">locals</span>(),<br>                               context_instance<span style="color: #666666" _mce_style="color: #666666;">=</span>RequestContext(request))<br></pre></div><p><br><br><br>And the test.html Template:<br></p><div class="highlight"><pre><span style="color: #007020" _mce_style="color: #007020;">{%</span> <span style="color: #007020; font-weight: bold" _mce_style="color: #007020; font-weight: bold;">extends</span> <span style="color: #4070a0" _mce_style="color: #4070a0;">"base.html"</span> <span style="color: #007020" _mce_style="color: #007020;">%}</span><br><br><span style="color: #007020" _mce_style="color: #007020;">{%</span> <span style="color: #007020; font-weight: bold" _mce_style="color: #007020; font-weight: bold;">block</span> <span style="color: #bb60d5" _mce_style="color: #bb60d5;">content</span> <span style="color: #007020" _mce_style="color: #007020;">%}</span><br>    <span style="color: #007020" _mce_style="color: #007020;">{%</span> <span style="color: #007020; font-weight: bold" _mce_style="color: #007020; font-weight: bold;">if</span> <span style="color: #bb60d5" _mce_style="color: #bb60d5;">info</span> <span style="color: #007020" _mce_style="color: #007020;">%}</span><br>        <span style="color: #062873; font-weight: bold" _mce_style="color: #062873; font-weight: bold;">&lt;pre&gt;</span><span style="color: #007020" _mce_style="color: #007020;">{{</span> <span style="color: #bb60d5" _mce_style="color: #bb60d5;">info</span> <span style="color: #007020" _mce_style="color: #007020;">}}</span><span style="color: #062873; font-weight: bold" _mce_style="color: #062873; font-weight: bold;">&lt;/pre&gt;</span><br>    <span style="color: #007020" _mce_style="color: #007020;">{%</span> <span style="color: #007020; font-weight: bold" _mce_style="color: #007020; font-weight: bold;">else</span> <span style="color: #007020" _mce_style="color: #007020;">%}</span><br><br>        <span style="color: #062873; font-weight: bold" _mce_style="color: #062873; font-weight: bold;">&lt;form</span> <span style="color: #4070a0" _mce_style="color: #4070a0;">action=""</span> <span style="color: #4070a0" _mce_style="color: #4070a0;">method="post"</span><span style="color: #062873; font-weight: bold" _mce_style="color: #062873; font-weight: bold;">&gt;</span><br>        <span style="color: #007020" _mce_style="color: #007020;">{{</span> <span style="color: #bb60d5" _mce_style="color: #bb60d5;">form.as_p</span> <span style="color: #007020" _mce_style="color: #007020;">}}</span><br>        <span style="color: #062873; font-weight: bold" _mce_style="color: #062873; font-weight: bold;">&lt;p&gt;&lt;input</span> <span style="color: #4070a0" _mce_style="color: #4070a0;">type="submit"</span> <span style="color: #4070a0" _mce_style="color: #4070a0;">value="go"</span><span style="color: #062873; font-weight: bold" _mce_style="color: #062873; font-weight: bold;">/&gt;&lt;/p&gt;</span><br>        <span style="color: #062873; font-weight: bold" _mce_style="color: #062873; font-weight: bold;">&lt;/form&gt;</span><br>    <span style="color: #007020" _mce_style="color: #007020;">{%</span> <span style="color: #007020; font-weight: bold" _mce_style="color: #007020; font-weight: bold;">endif</span> <span style="color: #007020" _mce_style="color: #007020;">%}</span><br><span style="color: #007020" _mce_style="color: #007020;">{%</span> <span style="color: #007020; font-weight: bold" _mce_style="color: #007020; font-weight: bold;">endblock</span> <span style="color: #007020" _mce_style="color: #007020;">%}</span><br></pre></div><div class="blogger-post-footer"><img width="1" height="1" src="https://blogger.googleusercontent.com/tracker/4123748873183487963-5947824555473713916?l=bradmontgomery.blogspot.com" _mce_src="https://blogger.googleusercontent.com/tracker/4123748873183487963-5947824555473713916?l=bradmontgomery.blogspot.com" alt=""></div>