---
date: '2008-07-16T10:37:00+00:00'
title: 'Django: Generating an Image with PIL'
draft: false
tags: []
slug: django-generating-an-image-with-pil
description: I've been reading th...
markup: html
url: /blog/django-generating-an-image-with-pil/
aliases:
- /blog/2008/07/16/django-generating-an-image-with-pil/

---

I've been reading through the <a href="http://www.djangobook.com/">Django Book</a>, and in <a href="http://www.djangobook.com/en/1.0/chapter11/">chapter 11</a> they talk about generating non-HTML content (such as PDF files, Images, RSS/Atom Feeds).  They mention using <a href="http://www.pythonware.com/products/pil/">PIL</a> to generate images, but they don't give an example.  So, I thought I'd post a simple example View that generates an image.<br /><br /><div class="highlight" ><pre><span style="color: #007020; font-weight: bold">def</span> <span style="color: #06287e">pil_image</span>(request):<br />    <span style="color: #4070a0; font-style: italic">&#39;&#39;&#39; A View that Returns a PNG Image generated using PIL&#39;&#39;&#39;</span><br /><br />    <span style="color: #007020; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">Image</span><span style="color: #666666">,</span> <span style="color: #0e84b5; font-weight: bold">ImageDraw</span> <br /><br />    size <span style="color: #666666">=</span> (<span style="color: #40a070">100</span>,<span style="color: #40a070">50</span>)             <span style="color: #60a0b0; font-style: italic"># size of the image to create</span><br />    im <span style="color: #666666">=</span> Image<span style="color: #666666">.</span>new(<span style="color: #4070a0">&#39;RGB&#39;</span>, size) <span style="color: #60a0b0; font-style: italic"># create the image</span><br />    draw <span style="color: #666666">=</span> ImageDraw<span style="color: #666666">.</span>Draw(im)   <span style="color: #60a0b0; font-style: italic"># create a drawing object that is</span><br />                                <span style="color: #60a0b0; font-style: italic"># used to draw on the new image</span><br />    red <span style="color: #666666">=</span> (<span style="color: #40a070">255</span>,<span style="color: #40a070">0</span>,<span style="color: #40a070">0</span>)    <span style="color: #60a0b0; font-style: italic"># color of our text</span><br />    text_pos <span style="color: #666666">=</span> (<span style="color: #40a070">10</span>,<span style="color: #40a070">10</span>) <span style="color: #60a0b0; font-style: italic"># top-left position of our text</span><br />    text <span style="color: #666666">=</span> <span style="color: #4070a0">&quot;Hello World!&quot;</span> <span style="color: #60a0b0; font-style: italic"># text to draw</span><br />    <span style="color: #60a0b0; font-style: italic"># Now, we&#39;ll do the drawing: </span><br />    draw<span style="color: #666666">.</span>text(text_pos, text, fill<span style="color: #666666">=</span>red)<br />    <br />    <span style="color: #007020; font-weight: bold">del</span> draw <span style="color: #60a0b0; font-style: italic"># I&#39;m done drawing so I don&#39;t need this anymore</span><br />    <br />    <span style="color: #60a0b0; font-style: italic"># We need an HttpResponse object with the correct mimetype</span><br />    response <span style="color: #666666">=</span> HttpResponse(mimetype<span style="color: #666666">=</span><span style="color: #4070a0">&quot;image/png&quot;</span>)<br />    <span style="color: #60a0b0; font-style: italic"># now, we tell the image to save as a PNG to the </span><br />    <span style="color: #60a0b0; font-style: italic"># provided file-like object</span><br />    im<span style="color: #666666">.</span>save(response, <span style="color: #4070a0">&#39;PNG&#39;</span>)<br /><br />    <span style="color: #007020; font-weight: bold">return</span> response <span style="color: #60a0b0; font-style: italic"># and we&#39;re done!</span><br /></pre></div><br /><br />This example just draws simple text, but the drawing code could be replaced by something more elaborate such as code that opens and scales existing images.<br /><br />A note of concern:  The Image object (im) <b>MUST</b> be saved as a PNG for this to work.  Luckily, the Image.save method expects a file-like object as its first parameter, so we can use django's HttpResponse object here.  Also, the example above doesn't make use of any particular Font for the drawing, so if you do want to draw text, you'll want to take a look at PIL's <a href="http://www.pythonware.com/library/pil/handbook/imagedraw.htm">ImageDraw Documentation</a>.<br /><br />(on a side note: the html for the code above was generated using <a href="http://dpaste.com">dpaste</a>, which rocks!)<div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/4123748873183487963-9092702185978828760?l=bradmontgomery.blogspot.com' alt='' /></div>