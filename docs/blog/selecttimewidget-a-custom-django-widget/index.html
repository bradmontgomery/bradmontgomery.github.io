<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>SelectTimeWidget: A custom Django Widget</title>
    
    <link rel="stylesheet" href="/static/simple.css-2.2.1/simple.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Abril+Fatface&family=Anonymous+Pro:wght@700&family=Rubik+Doodle+Shadow&display=swap" rel="stylesheet">
    <style type="text/css">
    h1,h2,h3 { font-family: 'Rubik Doodle Shadow', serif;}
    h4,h5,h6 {font-family: 'Abril Fatface', serif}
    code,pre { font-family: 'Anonymous Pro', monospace;}
    </style>
  </head>
  <body>
    <header>
      <nav>
        <a href="/">Home</a>
        <a href="/blog/">Blog</a>
        <a href="/blog/tags/">Tags</a>
        <a href="/about/">About</a>
        <a href="/services/">Services</a>
        <a href="/contact/">Contact</a>
      </nav>
      <h1>SelectTimeWidget: A custom Django Widget</h1>
      
  <div>Published on 2008-11-18 19:40:00+00:00</div>
  
    <div>
    
      <mark>Python</mark> &nbsp;
    
      <mark>django</mark> &nbsp;
    
    </div>
  

    </header>
    <main>
    
  <section>
  
<p>I've been meaning to write this blog post for quite some time...</p>
<p>Django Models provide a way to create a definitive source of data for web applications. Written as a python class, a Django Model consists of Fields that (among other things) define a <em>type</em> for your data.</p>
<p>Django's Forms provide a mechanism for generating HTML form elements and validating user input. A sublcass of Django's Form class is the ModelForm which essentially creates a Form based on the Fields in a Model. Form Fields and Model Fields are not the same--though there is a <a href="http://docs.djangoproject.com/en/dev/topics/forms/modelforms/#field-types">mapping from Model fields to Form fields</a>, however. The Fields in a Form define the validation logic for the data entered into the html form elements generated by the Field.</p>
<p>When Django renders a Form, it chooses an appropriate html form element (such as input, textarea, or select elements) based on the type of Fields in the Form. For example a form to save a URL with an associated title might look something like the following:</p>
<pre><code>from django import forms  
  
class LinkForm(forms.Form):  
    title = forms.CharField()   
    url = forms.URLField()  

</code></pre>
<p>The HTML generated by calling this forms <em>as_table()</em> method might look something like this:</p>
<pre><code>&gt;&gt;&gt; f = LinkForm()  
&gt;&gt;&gt; f.as_table()  
&lt;tr&gt;&lt;th&gt;Title:&lt;/th&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;title&quot; /&gt;&lt;/td&gt;&lt;/tr&gt;  
&lt;tr&gt;&lt;th&gt;Url:&lt;/th&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;url&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;  

</code></pre>
<p>We can change the behaviour of this output HTML by specifying a specific widget for the Form. If for some <em>strange</em> reason we wanted the Title to render in a textarea, we would do the following:</p>
<pre><code>title = forms.CharField(widget=forms.Textarea)  

</code></pre>
<p>All of this is well-documented in Django's <a href="http://docs.djangoproject.com/en/dev/ref/forms/widgets/">Widget documentation</a>, which has been working well for me 80% of the time.</p>
<p>My big complaint here is that Date and Time information defaults to text input elements. In the past, I've always liked to use select elements for situations when users would need to enter things like dates (perhaps a different select element for Months, Days, and Years) and time (different select elements for Hours, Minutes...</p>
<p>Luckily, (as of version 1.0, I think), Django offers a <strong>SelectDateWidget</strong> (located in <code>django.forms.extras.widgets</code>) which accomplishes this very thing. It produces three select elements, and it can be attached to a Form's DateField. This is accomplished like so:</p>
<pre><code>some_date = forms.DateField(widget=SelectDateWidget, initial=datetime.date.today())  

</code></pre>
<p>That's Awesome! I can even tell the widget to default to &quot;today's&quot; date by passing it an <em>initial</em> parameter containing the value generated by <em>datetime.date.today()</em>. Ok... what about times? Would we ever want to enter Time information as three separate select elements. I do, so I basically altered the <strong>SelectDateWidget</strong>, creating a <a href="http://www.djangosnippets.org/snippets/1202/"><strong>SelectTimeWidget</strong></a>, which is available on <a href="http://www.djangosnippets.org/snippets/1202/">django snippets</a>. It isn't perfect, but for now, it has accomplished what I've wanted... and its fairly flexible.</p>
<pre><code># Specify a basic 24-hr time Widget (the default)  
t = forms.TimeField(widget=SelectTimeWidget())  
  
# Force minutes and seconds to be displayed in increments of 10  
t = forms.TimeField(widget=SelectTimeWidget(minute_step=10, second_step=10))  
  
# Use a 12-hr time format, which will display a 4th select   
# element containing a.m. and p.m. options)  
t = forms.TimeField(widget=SelectTimeWidget(twelve_hr=True))  

</code></pre>
<p>However, I often use DateTimeFields in both Models and Forms (which consists of date and time info). All the code I need to represent select elements for such a field exists in both <strong>SelectDateWidget</strong> and <strong>SelectTimeWidget</strong>s. The problem? I just have figured out a <em>good</em> (read: proper) way to combine these two Widget classes.</p>
<p>Do I use multiple inheritance here... mixins... ? My experience doing this in python is a bit rusty... (erm, non-existent!) Hopefully the helpful <a href="http://groups.google.com/group/django-users/">django community</a> will help me out. :)</p>
<hr />
<p>UPDATE: This discussion is continued in <a href="/blog/extending-djangos-multiwidget-splitselectdatetimewidget/">Extending Django's MultiWidget: SplitSelectDateTimeWidget</a>. I found a solution to this problem simply by digging through Django's source code. Huzzah for Open Source!</p>
<hr />
<p>So if you had a project called <em>mysite</em> and an app called <em>myapp</em>, putting it all together would look something like this:</p>
<pre><code># in urls.py  
urlpatterns += patterns('',  
    (r'^test/$', 'mysite.myapp.views.test'),  
)  
  
# in forms.py  
class TestForm(forms.Form):  
    t = forms.TimeField(widget=SelectTimeWidget(minute_step=15, second_step=30, twelve_hr=True))  
  
  
# in views.py  
def test(request):  
    from forms import TestForm  
      
    if request.method == 'POST':  
        form = TestForm(request.POST)  
        if form.is_valid():  
            info = form.cleaned_data  
    else:  
        form = TestForm()  
          
    return render_to_response('myapp/test.html',  
                               locals(),  
                               context_instance=RequestContext(request))  

</code></pre>
<p>And the test.html Template:</p>
<pre><code>{% extends &quot;base.html&quot; %}  
  
{% block content %}  
    {% if info %}  
        &lt;pre&gt;{{ info }}&lt;/pre&gt;  
    {% else %}  
  
        &lt;form action=&quot;&quot; method=&quot;post&quot;&gt;  
        {{ form.as\_p }}  
        &lt;p&gt;&lt;input type=&quot;submit&quot; value=&quot;go&quot;/&gt;&lt;/p&gt;  
        &lt;/form&gt;  
    {% endif %}  
{% endblock %}  

</code></pre>
<p><img src="https://blogger.googleusercontent.com/tracker/4123748873183487963-5947824555473713916?l=bradmontgomery.blogspot.com" alt="" /></p>

  </section>

    </main>
    <footer>
      All content copyright &copy; Brad Montgomery.
    </footer>
  </body>
</html>
